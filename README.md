# 表达式求导与化简工具 (Java编译原理实践)

## 1. 项目概述

这是我在学习Java和面向对象编程时，独立完成的一个综合性课程设计项目。

项目的核心目标是，设计并实现一个能够**解析、求导、并化简复杂数学表达式**的工具。这个表达式不仅包含常规的多项式和三角函数，还支持**用户自定义函数**，甚至包括**递归函数的定义**。

这个项目是我对**编译原理**核心思想的一次完整实践。我没有使用任何现成的语法分析库，而是从零开始，亲手构建了从**词法分析、语法分析、抽象语法树(AST)构建**到最终的**符号计算**（求导与化简）的全过程。

---

## 2. 系统架构与核心设计

我将整个处理流程分成了两个核心阶段：**前端的解析与建树** 和 **后端的计算与化简**。

### **阶段一：表达式的解析与抽象语法树 (AST) 构建**

这是编译原理的前端部分，负责将输入的字符串转化为程序可以理解的数据结构。

*   **词法分析 (`Lexer.java`):**
    *   我实现了一个**词法分析器**，它负责扫描输入的字符串，并将其分解为一系列带有明确类型的**词法单元 (Token)**，例如 `NUM`, `ADD`, `SIN`, `FUNC`, `LPAREN` 等。

*   **语法分析 (`Parser.java`):**
    *   我采用**递归下降 (Recursive Descent)** 的方法，编写了一个**语法分析器**。
    *   通过`parseExpr()`, `parseTerm()`, `parseFactor()`等一系列相互调用的方法，它能够根据表达式的巴科斯范式(BNF)文法，将线性的Token流，构建成一棵层次分明的**抽象语法树 (AST)**。

*   **AST 的面向对象设计:**
    *   我将AST的节点设计为一系列实现了`Factor`接口的类（如`Num`, `Power`, `Tri`, `Expr`等）。
    *   这形成了一个典型的**组合模式 (Composite Pattern)**：一个`Expr`（表达式）由多个`Term`（项）组成，一个`Term`又由多个`Factor`（因子）组成，而`Expr`本身也可以作为一个`Factor`出现。这种递归结构，使得处理任意复杂的嵌套表达式变得非常优雅和自然。

### **阶段二：基于AST的符号计算**

当AST构建完成后，所有的计算和操作都是在这棵树上以**递归**的方式进行的。

*   **符号求导 (`derivative()`):**
    *   我为`Factor`接口定义了`derivative()`方法，并为每个节点类（`Expr`, `Term`, `Num`, `Tri`等）提供了具体的实现。
    *   求导过程完全遵循微积分的链式法则、乘法法则和加法法则。例如，对一个`Term`求导，会递归地对其下的每个`Factor`求导，并与其他因子相乘后求和。
    *   整个求导过程的**输出，不是一个数值，而是一棵新的、代表导数表达式的AST**。

*   **表达式化简与输出 (`toPoly()`):**
    *   为了实现最终的化简和输出，我设计了一套内部多项式表示 (`Poly`, `OperaTerm`, `Mono`, `Trig`)。
    *   `toPoly()`方法负责将AST递归地转化为这个内部多项式结构，并在这个过程中完成同类项的合并、系数的计算等化简操作。
    *   最终，通过重写`toString()`方法，将化简后的多项式结构打印成符合要求的字符串。

### **高级功能：自定义函数与递归**
*   **`FuncLib`, `Define`, `Recur`:** 我设计了这一系列类来支持用户自定义函数。系统能够解析函数的定义（包括参数列表和函数体），并在主表达式中调用时，通过**变量替换** (`replace()`方法) 的方式，将自定义函数体展开并整合到主AST中。
*   **递归展开:** 对于递归函数的定义，系统能够在求值时，根据递归的层数，**动态地展开**函数定义，实现对递归函数的符号计算。

---

## 3. 技术与能力总结

*   **编译原理:** 深入实践了**词法分析、递归下降语法分析、抽象语法树构建**等编译器前端核心技术。
*   **面向对象设计 (OOP):** 成功应用了**组合模式**来设计AST，并通过**接口**和**多态**实现了对不同类型表达式节点的统一处理。
*   **设计模式:** 在自定义函数模块中，应用了**工厂模式**的思想来管理和创建函数实例。
*   **数据结构与算法:** 熟练运用`ArrayList`, `HashMap`等数据结构，并在函数调用和求导中大量使用了**递归**思想。

---

## 4. 如何运行

1.  克隆本仓库到本地。
2.  使用IDE（如IntelliJ IDEA, Eclipse）打开项目。
3.  找到 `main/MainClass.java` 并运行。
4.  程序将从控制台读取输入，包括自定义函数的定义和待求导的表达式，然后输出化简后的导数结果。